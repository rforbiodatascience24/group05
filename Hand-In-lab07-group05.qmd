---
title: "Lab 7 Assignment: Group 05"
subtitle: 'Students: s243284, s242872,	s243302,	s243547,	s243360'
format:
  html:
    embed-resources: true
editor: visual
---

Library

```{r}
library(tidyverse)
library(broom)
library(cowplot)
```

## Data

```{r}
biopsy <- read_csv("https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv")
```

## Miguel (Until first graph)

Select numeric data and run PCA

```{r}
pca_fit <- biopsy |> 
  select(where(is.numeric)) |> 
  prcomp(scale = TRUE)
```

```{r}
pca_fit %>%
  augment(biopsy) %>% # add original dataset back in
  ggplot(aes(.fittedPC1, .fittedPC2, color = outcome)) + 
  geom_point(size = 1.5) +
  scale_color_manual(
    values = c(malignant = "#D55E00", benign = "#0072B2")
  ) +
  theme_half_open(12) + background_grid()
```

## Xavi

## Natalia

## Dani

## Luis

```{r}
#| echo: true
#| eval: false

base_url <- "http://userweb.eng.gla.ac.uk/umer.ijaz/bioinformatics/ecological/"
raw_data_path <- "data/_raw/"

if (!dir.exists("data/_raw/")) {  #The folder data/_raw needs to be created before!!
  dir.create("data/_raw/", recursive = TRUE)
}

SPE <- read_csv(file = str_c(base_url, "SPE_pitlatrine.csv"))
write_csv(x = SPE,
          file =str_c(raw_data_path, "SPE_pitlatrine.csv"))

ENV <- read_csv(file = str_c(base_url, "ENV_pitlatrine.csv"))
write_csv(x = ENV,
          file = str_c(raw_data_path, "ENV_pitlatrine.csv"))

```

```{r}
SPE |> 
  pivot_longer(cols = -Taxa,
               names_to = "Samples",
               values_to = "OTU_Count")  |> 
  full_join(ENV, by = "Samples") |> 
  mutate(site = case_when(str_detect(Samples, "^T") ~ "Tanzania",
                          str_detect(Samples, "^V") ~ "Vietnam")) |>  
  write_tsv(file = "data/SPE_ENV.tsv")
```
